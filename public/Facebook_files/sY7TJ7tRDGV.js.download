;/*FB_PKG_DELIM*/

__d("getMAWIdentityKeys",["MAWBridgeSendAndReceive","MAWRestoreRewriteUtils","ReQL","WADbSignal","WALogger","WASignalKeys","asyncToGeneratorRuntime","err","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);h=function(){return a};return a}var i="IdentityKey was null";function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("MAWRestoreRewriteUtils").isOneDBEnabled()&&!c("isInstamadilloEB")()){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.e2ee_meta).getKeyRange(d("WADbSignal").MetaKeysEnum.identityKeyPair)));a=a==null?void 0:a.value.identityKeyPair;if(a==null){d("WALogger").ERROR(h(),i);throw c("err")(i)}var b=d("WASignalKeys").serializePubKey(a);a=a.privateKey;return{identityPrivateKey:a,identityPublicKey:b}}return d("MAWBridgeSendAndReceive").sendAndReceive("backend","getIdentityKeys",void 0,6e4)});return j.apply(this,arguments)}g["default"]=a}),98);
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);var c=a.pk;a=a.sk;return(h||(h=b("Promise"))).resolve([a.buffer,c.buffer])})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("create_auth_key_pair"),a).mustfix("failed to generate an auth key pair");throw a})};g["default"]=a}),98);
__d("LSCreateEncryptionKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateEncryptionKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_encryption_key_pair");d("CryptoLogger").captureError(b,a).mustfix("failed to generate an encryption key pair");throw a})};g["default"]=a}),98);
__d("LSCreateSignatureKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignatureKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Signing);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_signature_key_pair");d("CryptoLogger").captureError(b,a).mustfix("Failed to create signing key pair keys");throw a})};g["default"]=a}),98);
__d("LSCreateSignature_v2.nop",["CryptoLogger","LSResult","Promise","UInt8Array","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignature_v2.nop");function j(a){return c("LSResult")(a)}function k(a,b){return d("UInt8Array").concatBytes([b,a].map(function(a){return new Uint8Array(a)}))}a=function(a,c,e,f,g){var l=d("CryptoLogger").CryptoLogger("create_signature_v2");if(f.byteLength!==1){l.mustfix("Bad aad for signing, should be 1 byte");return(h||(h=b("Promise"))).resolve(j(void 0))}return i.load().then(function(a){var c=a.secretKeyFromBytes(new Uint8Array(e),a.KeyPurpose.Signing);if(c!=null)return a.sign(c,k(g,f)).then(function(a){return(h||(h=b("Promise"))).resolve(j(a.buffer))});l.mustfix("No Signature Private key");return(h||(h=b("Promise"))).resolve(j(void 0))})};g["default"]=a}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateLocalKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),a[0]?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),d[25]=c.createArray(),void 0!==void 0?d[26]=(d[25].push(void 0),d[25]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure","Fetching keys locally failed. Reason: 1",d[25],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[17]=a[0],d[18]=a[1],d[19]=a[2],d[20]=a[3],d[21]=a[4],d[22]=a[5],d[23]=a[6],a}]):(e=a.item,c.sequence([function(a){return d[36]=e.backupTenancy,d[35]=e.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[25]=void 0):c.sequence([function(a){return d[37]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[47]=(d[37].push(c.i64.cast([0,0])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[47]=(d[37].push(c.i64.cast([0,2])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[47]=(d[37].push(c.i64.cast([0,3])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[47]=(d[37].push(c.i64.cast([0,4])),d[37]):0,d[42]=c.createArray(),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[42].push(d[48]),d[42])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[47]=c.createArray(),d[48]=c.i64.of_int32(d[42].length),c.i64.gt(d[48],c.i64.cast([0,0]))?c.loopAsync(d[48],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[47].push(c.i64.to_string(d[51])),d[47])}])}):c.resolve()},function(a){return d[49]=d[47].join(","),d[44]=d[49]}])},function(a){return d[42].some(function(a){return c.i64.eq(d[35],a)})?d[45]=d[35]:d[45]=void 0,c.i64.neq(d[45],void 0)?d[46]=d[45]:d[46]=void 0,d[25]=d[46]}])},function(a){return c.i64.neq(d[25],void 0)?d[26]=d[25]:d[26]=c.i64.cast([0,0]),c.i64.neq(d[36],void 0)?d[27]=d[36]:d[27]=c.i64.cast([0,1]),c.i64.neq(e.deviceId,void 0)?c.resolve((a=[!0,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],d[32]=a[4],d[33]=a[5],d[34]=a[6],a)):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),d[37]=c.createArray(),void 0!==void 0?d[38]=(d[37].push(void 0),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure","Fetching keys locally failed. Reason: 24",d[37],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],d[32]=a[4],d[33]=a[5],d[34]=a[6],a}])},function(a){return a=[d[28],d[29],d[30],d[31],d[32],d[33],d[34]],d[17]=a[0],d[18]=a[1],d[19]=a[2],d[20]=a[3],d[21]=a[4],d[22]=a[5],d[23]=a[6],a}]))})},function(a){return a=[d[17],d[18],d[19],d[20],d[21],d[22],d[23]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}]):c.sequence([function(a){return c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return a=[!0,d[18],d[17],d[20],d[19],d[22],d[21]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(a){return d[2]?c.sequence([function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[4],c.blob("MA=="),d[5]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[4],c.blob("MQ=="),d[7]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=new c.Map(),d[19].set("device_private_key",d[4]),d[19].set("device_public_key",d[3]),d[20]=new c.Map(),d[20].set("epoch_storage_private_key",d[6]),d[20].set("epoch_storage_public_key",d[5]),d[21]=new c.Map(),d[21].set("epoch_auth_private_key",d[8]),d[21].set("epoch_auth_public_key",d[7]),d[22]=new c.Map(),d[22].set("device_key",d[19]),d[22].set("epoch_storage_key",d[20]),d[22].set("epoch_storage_public_key_sig",d[17]==null?c.blob("bnVsbA=="):d[17]),d[22].set("epoch_auth_key",d[21]),d[22].set("epoch_auth_public_key_sig",d[18]==null?c.blob("bnVsbA=="):d[18]),a=[d[22],void 0],d[9]=a[0],d[10]=a[1],a}]):c.resolve((d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,9])),d[17].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),d[17].set("error_message",""),a=[void 0,d[17]],d[9]=a[0],d[10]=a[1],a))},function(a){return d[11]=c.i64.of_float(Date.now()),d[12]=c.i64.random(),d[14]="Finishing execution. Execution time: ",d[15]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[13]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateLocalKeys] ",d[13],d[14],d[13],d[15],d[13],d[16]].join("")),c.i64.eq(c.i64.mod_(d[12],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[17]=",",d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateLocalKeys",[d[14],d[17],d[15],d[17],d[16]].join(""),d[18],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[9],d[10]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSBase64Decode.nop",["Base64Utils","CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){a=a.replace(/-/g,"+").replace(/_/g,"/").replace(/\./g,"=").replace("/,/","=");var b=4-a.length%4;if(b<4)for(var c=0;c<b;c++)a+="=";return a}function j(a){var b=d("CryptoLogger").CryptoLogger("base64decode");try{return a!=null?d("Base64Utils").toArrayBuffer(i(a)):void 0}catch(c){if((c==null?void 0:c.message)==null)return;if(c instanceof Error)b.catching(c).mustfix(c.message);else{b.mustfix("Base64decode : empty error message for exception: %s, input string: %s",c.message,(b=a)!=null?b:"undefined")}}}a=function(a,d,e){return(h||(h=b("Promise"))).resolve(c("LSResult")(j(e)))};g["default"]=a}),98);
__d("ArrayBuffer",["UInt8Array"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.map(function(a){return new Uint8Array(a)});return d("UInt8Array").concatBytes(a).buffer}g.mergeBuffers=a}),98);
__d("LSCreateDebugToken.nop",["ArrayBuffer","Base64Utils","CryptoLogger","I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec","Promise","RetUtil","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("LSCryptoUtils").strToBuf("debug_token_type_"),k=d("LSCryptoUtils").strToBuf("debug_token_rkid"),l=d("LSCryptoUtils").strToBuf("debug_token_anon"),m=(i||(i=d("I64"))).of_string("32"),n=i.of_string("12");function o(a){return Array.from(a.keys()).reduce(function(b,c){var d=a.get(c);d!=null&&(b[c]=d);return b},{})}function p(a){return new Int32Array([new DataView(new Int32Array([a]).buffer).getInt32(0)]).buffer}function q(a,b){var c=b.length;a=d("ArrayBuffer").mergeBuffers([a,p(c)]);return d("ArrayBuffer").mergeBuffers([a,d("LSCryptoUtils").strToBuf(b)])}function r(a,b){var c=b.keys().sort();return c.reduce(function(a,c){var d=b.get(c);return d!=null?q(q(a,c),d):a},q(j,a))}function s(a,b,d,e,f){return c("LSCreateDerivedKeys.nop")(a,b,d,void 0,e,c("LSVec").ofArray([f])).then(function(a){a=a[0];if(a==null)return void 0;a=c("LSVec").toArray(a);return a.length===1?a[0]:void 0})}function t(a,e,f,g,j){return(i||(i=d("I64"))).equal((i||(i=d("I64"))).zero,j)?s(a,e,l,g,m).then(function(b){return s(a,e,f,c("nullthrows")(b),(i||(i=d("I64"))).of_int32(f.byteLength))}):(h||(h=b("Promise"))).resolve(f)}function u(a,b,d,e,f,g,h){return s(a,b,d,e,f).then(function(d){return t(a,b,c("nullthrows")(d),g,h)})}a=function(a,e,f,g,j,l,p){try{return(h||(h=b("Promise"))).all([s(a,e,r(g,p),f,m).then(function(b){return u(a,e,j,c("nullthrows")(b),n,f,l)}),u(a,e,k,f,n,f,l)]).then(function(a){var b=a[0];a=a[1];return d("RetUtil").getNullableRetResult(d("LSCryptoUtils").strToBuf(JSON.stringify({ctx:(i||(i=d("I64"))).equal((i||(i=d("I64"))).zero,l)?"anon":"auth",rkid:d("Base64Utils").fromArrayBuffer(c("nullthrows")(a)),scopes:o(p),type:g,val:d("Base64Utils").fromArrayBuffer(c("nullthrows")(b))})))})}catch(a){d("CryptoLogger").CryptoLogger("create_debug_token").warn("getExn Error");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}};g["default"]=a}),98);
__d("ArmadilloSignatures",["WASignalKeys","WASignalOther","WASignalSignatures","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c,e=(c=d("WASignalOther")).ensureSize(d("XPlatReactCrypto").getRandomValues(new Uint8Array(64)),64);return d("WASignalSignatures").makeSignature(d("WASignalKeys").makeKeyPairFromArrayBuffers(c.toBuffer(c.makeBytes(32)),c.toBuffer(a)),b,e)}function b(a,b,c){return d("WASignalSignatures").verifyMsgSignalVariant(d("WASignalSignatures").convertPublicKeyToSerializedPubKey(b),c,a)}g.armadilloSign=a;g.validateArmadilloSignature=b}),98);
__d("LSCreateSignatureWithArmadilloKey.nop",["ArmadilloSignatures","LSResult","getMAWIdentityKeys"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e){return c("getMAWIdentityKeys")(a).then(function(a){a=a.identityPrivateKey;return d("ArmadilloSignatures").armadilloSign(a,new Uint8Array(e))}).then(function(a){return c("LSResult")(a.buffer)})};g["default"]=a}),98);
__d("LSGetArmadilloPublicKey.nop",["CryptoLogger","Promise","RetUtil","getMAWIdentityKeys"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e){return c("getMAWIdentityKeys")(a).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a.identityPublicKey.buffer))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("get_armadillo_keys");c.catching(a).mustfix("Failed to get identity keys.");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("ObliviousConsistentMappingFunction",["FBLogger","UInt8Array","nullthrows","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ristretto255").__setRef("ObliviousConsistentMappingFunction");function i(a){return a.some(function(a){return a!==0})}function j(a){while(!0){var b=a.getRandom();if(i(b))return b;continue}return new Uint8Array(0)}var k=c("nullthrows")(d("UInt8Array").fromHexString("edd3f55c1a631258d69cf7a2def9de1400000000000000000000000000000010"));function l(a){return"ClientState has length "+String(a)+", expected "+String(32)}function a(a){return"ClientState is greater or equal to max: "+a.toString()}var m="ClientState is zero.";function n(a){var b=a.length;if(b!==32)throw c("FBLogger")("labyrinth_web").mustfixThrow(l(b));b=a.reduce(function(b,a){if(b)return!0;else return a>0},!1);if(!b)throw c("FBLogger")("labyrinth_web").mustfixThrow(m);b=!1;for(var d=31;d>=0;--d)if(!b){var e=a[d],f=k[d];if(e>f)throw c("FBLogger")("labyrinth_web").mustfixThrow("ClientState is greater or equal to max: "+a.toString());e<f&&(b=!0)}if(!b)throw c("FBLogger")("labyrinth_web").mustfixThrow("ClientState is greater or equal to max: "+a.toString())}function b(a){n(a);return h.load().then(function(b){var c=j(b.scalar),d=b.scalar.mul(a,c);b=b.scalar.invert(c);return{evolveToken:b,newClientState:d}})}g.checkNonZero=i;g.maxState=k;g.buildInputLengthErrorMsg=l;g.buildInputValueErrorMsg=a;g.getInputZeroErrorMsg=m;g.clientEvolve=b}),98);
__d("LSOcmfClientEvolve_v2.nop",["CryptoLogger","ObliviousConsistentMappingFunction"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("ObliviousConsistentMappingFunction").clientEvolve(new Uint8Array(c)).then(function(a){return[a.newClientState.buffer,a.evolveToken.buffer]})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_evolve_v2"),a).mustfix("Failed to evolve client.");throw a})};g["default"]=a}),98);
__d("PublicKeyEncryptionUtils",["Promise","UInt8Array","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){}function c(a){if(a!=null)return a;else return new Uint8Array(0).buffer}function e(a,b,c,e,f){return d("UInt8Array").concatBytes([a,b,c,e,f]).buffer}function f(a,b,c,e){return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveKey({hash:"SHA-256",info:c,name:"HKDF",salt:b},a,{length:256,name:"AES-GCM"},!1,[e])})}var i="key length is not "+32;function j(a,b){if(a.length!==32)return b(i)}function k(a){return new(h||(h=b("Promise")))(function(b,c){j(a,c);return b()})}var l=32;g.assertValidCurvePoint=a;g.getSalt=c;g.concatAad=e;g.getAesKey=f;g.testKeyLength=j;g.assertKeyLength=k;g.keyLength=l}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","XPlatReactCrypto","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("PublicKeyCrypto").__setRef("LSPublicEncryptionCreateDecryptedData.nop"),j=c("requireDeferred")("X25519").__setRef("LSPublicEncryptionCreateDecryptedData.nop");function k(a,b){var c=1+d("PublicKeyEncryptionUtils").keyLength+16;a=a.length;a<1+d("PublicKeyEncryptionUtils").keyLength+16&&b("CipherText length is "+a+", < "+c)}function l(a,b,c){b=b[0];if(b!==a)return c("Unexpected version "+b)}function m(a){return new(h||(h=b("Promise")))(function(b,c){l(1,a,c);k(a,c);return b()})}function n(a,c){return new(h||(h=b("Promise")))(function(b,e){d("PublicKeyEncryptionUtils").assertValidCurvePoint(a,e);d("PublicKeyEncryptionUtils").assertValidCurvePoint(c,e);return b()})}a=function(a,c,e,f,g,k,l,o){var p=new Uint8Array(l),q=new Uint8Array([1]),r=d("PublicKeyEncryptionUtils").getSalt(k),s=new Uint8Array(e),t=new Uint8Array(g),u=new Uint8Array(f),v=new Uint8Array(o);return(h||(h=b("Promise"))).all([d("PublicKeyEncryptionUtils").assertKeyLength(s),d("PublicKeyEncryptionUtils").assertKeyLength(u),d("PublicKeyEncryptionUtils").assertKeyLength(t)]).then(function(){return m(v)}).then(function(){return j.load()}).then(function(a){var c=v.slice(1,d("PublicKeyEncryptionUtils").keyLength+1),e=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);return n(e,t).then(function(){var f=d("PublicKeyEncryptionUtils").concatAad(q,t,s,c,p),g=function(c,d,f){c=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);d=a.publicKeyFromBytes(d,a.KeyPurpose.Encryption);f=a.secretKeyFromBytes(f,a.KeyPurpose.Encryption);return c==null||d==null||f==null||e==null?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).resolve([c,d,f,e])};return g(s,t,u).then(function(a){if(a==null)return;return{ephemeralPub:a[3],innerAad:f,receiverPriv:a[2],receiverPub:a[0],senderPub:a[1]}})})}).then(function(a){if(a==null)return;var b=a.ephemeralPub,c=a.receiverPriv,e=a.senderPub,f=a.innerAad;return i.load().then(function(a){return a.receiverDeriveSharedSecret(c,b,e)}).then(function(a){if(a==null)return null;else return d("PublicKeyEncryptionUtils").getAesKey(a,r,f,"decrypt")}).then(function(a){if(a==null)return;var b=new Uint8Array(12).buffer,c=v.slice(d("PublicKeyEncryptionUtils").keyLength+1).buffer;return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(b),name:"AES-GCM",tagLength:128},a,c)})}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("public_encryption_create_decrypted_data");d("CryptoLogger").captureError(c,a).mustfix("Creation of decrypted data for public encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))})};g["default"]=a}),98);