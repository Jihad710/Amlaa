;/*FB_PKG_DELIM*/

__d("MAWEncryptedBackupsRestoreDialogContexts_query.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWEncryptedBackupsRestoreDialogContexts_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup"},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'}],storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_vestaGetUserInfoResponse"}],storageKey:null}],storageKey:null}],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null};e.exports=a}),null);
__d("MWChatEncryptedBackupsRingIndeterminateIcon.react",["CometHeroHoldTrigger.react","MWXSpinner.react","react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react"),k={large:{minHeight:"x1zwvfr",$$css:!0},root:{alignItems:"x6s0dn4",display:"x78zum5",flexDirection:"xdt5ytf",justifyContent:"xl56j7k",$$css:!0},small:{minHeight:"x1edz59j",$$css:!0}};function a(a){a=a.size;a=a===void 0?"large":a;return j.jsxs("div",{className:(h||(h=c("stylex")))(k.root,k[a]),children:[j.jsx(c("CometHeroHoldTrigger.react"),{description:"MWEBRingSpinner",hold:!0}),j.jsx(c("MWXSpinner.react"),{color:"blue",size:60})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWEBQPResetPIN.react",["ix","CometImageFromIXValue.react","gkx","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("gkx")("23433");b=j.forwardRef(a);function a(a,b){var d=a.alt;a=a.xstyle;var e=k?h("421464"):h("421459");return j.jsx(c("CometImageFromIXValue.react"),{alt:d,ref:b,source:e,xstyle:a})}a.displayName=a.name+" [from "+f.id+"]";e=b;g["default"]=e}),98);
__d("MWEncryptedBackupsOTCEligibleDevicesContextProvider.react",["MWEncryptedBackupsOTCEligibleDevicesContext.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useMemo,k=b.useState;function a(a){a=a.children;var b=k(!0),c=b[0],e=b[1];b=k(!0);var f=b[0],g=b[1];b=k([]);var h=b[0],l=b[1];b=j(function(){return{failedToFetchOtcDevices:f,isFetchOtcDevicesInFlight:c,otcEligibleDevices:h,setFailedToFetchOtcDevices:g,setIsFetchOtcDevicesInFlight:e,setOtcEligibleDevices:l}},[f,c,h]);return i.jsx(d("MWEncryptedBackupsOTCEligibleDevicesContext.react").MWEncryptedBackupsOTCEligibleDevicesContext.Provider,{value:b,children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatEncryptedBackupsVestaUserInfoContext.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("react")).createContext;b=a({attemptsRemaining:null,loginTimeoutRemainingSecs:null,vestaClientID:null});g.VestaUserInfoContext=b}),98);
__d("MWChatEncryptedBackupsPinCodeRestoreStep.react",["fbt","FocusRegion.react","JSResourceForInteraction","MWChatEBPinCodeVerifyIndicator.react","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsVestaUserInfoContext.react","MWEBQPResetPIN.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXLink.react","MWXMultiStepDialogHeader.react","MWXText.react","QPLUserFlow","focusScopeQueries","gkx","lazyLoadComponent","promiseDone","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsPinCodeRestore","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useContext,l=b.useEffect,m=c("gkx")("23219"),n=c("JSResourceForInteraction")("MWChatEncryptedBackupsPinCodeBlockedStep.react").__setRef("MWChatEncryptedBackupsPinCodeRestoreStep.react"),o="chat-encrypted-backups-dialog-layout-restore-step";function a(a){var b=a.clientID,e=a.onChooseOtc,f=a.onClose,g=a.onComplete,i=a.onForgotPin;a=a.shouldShowForgotButton;a=a===void 0?!0:a;b=d("useMWChatEncryptedBackupsPinCodeRestore").useMWChatEncryptedBackupsPinCodeRestore({clientID:b,focusRegionId:o,onVestaComplete:g});var p=b.focusOnInput,q=b.inputProps,r=b.isInProgress,s=b.isLabyrinthError,t=b.isPinCodeIncorrect;b=b.isVestaError;var u=c("gkx")("2510")?h._("__JHASH__ZgAep0T7S_u__JHASH__"):h._("__JHASH__CPDJhi3l1S1__JHASH__"),v=k(d("MWChatEncryptedBackupsVestaUserInfoContext.react").VestaUserInfoContext),w=v.attemptsRemaining;v=v.loginTimeoutRemainingSecs;var x=w===0,y=x||v!=null&&v>0,z=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_SCREEN",function(){p(),A!=null&&c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_OPTION_DISPLAYED_RESTORE_SCREEN")});a=a?j.jsx(c("MWXLink.react"),{color:m?"primary":"highlight",disabled:y||r,display:"block",onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_FORGOT_PIN_CLICK"),i()},rel:"noreferrer",testid:void 0,children:j.jsx(c("MWXText.react"),{color:y||r?"disabled":"highlight",type:"button2",children:h._("__JHASH__UY_FDJp7Rzt__JHASH__")})}):null;var A=e!==null?j.jsx(c("MWXLink.react"),{color:m?"primary":"highlight",disabled:y||r,display:"block",onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),e()},rel:"noreferrer",testid:void 0,children:j.jsx(c("MWXText.react"),{color:y||r?"disabled":"highlight",type:"button2",children:h._("__JHASH__rIytKXj5Yr0__JHASH__")})}):null;a=A!=null?A:a;var B=h._("__JHASH__6pjlJMQcqkh__JHASH__"),C=c("lazyLoadComponent")(n);y=y?j.jsx(C,{attemptsRemaining:w,loginTimeoutRemainingSecs:v,onClose:f,onComplete:g}):j.jsx(c("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,ref:d("xplatToDOMRef").xplatToDOMRef(z),children:j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:16,spacing:0,children:[j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:16,children:j.jsx("div",{className:"xg87l8a",children:j.jsx(c("MWEBQPResetPIN.react"),{})})}),j.jsx(c("MWXColumnItem.react"),{align:"center",paddingVertical:16,children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:B})}),j.jsx(c("MWXColumnItem.react"),{align:"center",children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:j.jsx("div",{className:"x1l90r2v x2b8uid",children:u})})}),j.jsxs(c("MWXColumnItem.react"),{align:"center",children:[j.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:t?h._("__JHASH__TG8l6XqQAul__JHASH__"):s||b?h._("__JHASH__oI6Lha5PMTv__JHASH__"):void 0,children:j.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,id:o,children:j.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({},q,{disabled:v!=null||x||r,testid:void 0}))})}),r?j.jsx(c("MWChatEBPinCodeVerifyIndicator.react"),{isMessenger:m}):null]}),j.jsx(c("MWXColumnItem.react"),{align:"center",children:j.jsx("div",{className:"x1y1aw1k",children:a})})]})});l(function(){c("promiseDone")(n.load())},[]);return j.jsxs(j.Fragment,{children:[j.jsx(c("MWXMultiStepDialogHeader.react"),{withCloseButton:!1,withoutBackButton:!0}),y]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsAutoRestoreConsentStepDeferred.react",["deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsAutoRestoreConsentStep.react").__setRef("MWChatEncryptedBackupsAutoRestoreConsentStepDeferred.react"));function a(a){return i.jsx(j,babelHelpers["extends"]({},a))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatEncryptedBackupsDisableDismissalDialogContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({disableDismissalDialog:function(){}});g["default"]=b}),98);
__d("MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react",["MWChatEncryptedBackupsDisableDismissalDialogContext","MWChatEncryptedBackupsSetIsDialogPersistedContext","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useMemo;function a(a){var b=a.children,d=a.disableDismissalDialog,e=a.setIsDialogPersisted;a=j(function(){return{setIsDialogPersisted:e}},[e]);var f=j(function(){return{disableDismissalDialog:d}},[d]);if(e!=null)return i.jsx(c("MWChatEncryptedBackupsSetIsDialogPersistedContext").Provider,{value:a,children:b});return d!=null?i.jsx(c("MWChatEncryptedBackupsDisableDismissalDialogContext").Provider,{value:f,children:b}):b}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWEncryptedBackupsRestoreDialogContexts.react",["CometRelay","CometTransientDialogProvider.react","MAWEncryptedBackupsRestoreDialogContexts_query.graphql","MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react","MWChatEncryptedBackupsVestaUserInfoContext.react","MWChatEncryptedBackupsVirtualDevicesContextProvider.react","MWEBFlowSourceContextProvider.react","MWEncryptedBackupsOTCEligibleDevicesContextProvider.react","react","useMWChatEncryptedBackupsVestaUserInfo","useMWEncryptedBackupsGetVirtualDevicesPreloaded"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react")),k=i.useMemo;function a(a){var e,f=a.children,g=a.disableDismissalDialog,i=a.query,l=a.setIsDialogPersisted;a=a.source;i=d("CometRelay").useFragment(h!==void 0?h:h=b("MAWEncryptedBackupsRestoreDialogContexts_query.graphql"),i);e=(e=i.viewer.messenger_default_encrypted_backup)==null?void 0:e.vesta_user_info;var m=c("useMWChatEncryptedBackupsVestaUserInfo")({vestaGetUserInfoResponse$key:e});e=c("useMWEncryptedBackupsGetVirtualDevicesPreloaded")({encryptedBackup:i.xfb_backup});e=e.getVirtualDevices;e=e();var n=e.offlineDevicesCount;e=e.vestaClientID;var o=k(function(){return{attemptsRemaining:m.attemptsRemaining,loginTimeoutRemainingSecs:m.loginTimeoutRemainingSecs,vestaClientID:null}},[m.attemptsRemaining,m.loginTimeoutRemainingSecs]);return j.jsx(c("MWChatEncryptedBackupsVirtualDevicesContextProvider.react"),{hasOtcEligibleDevicesInitialValue:(i=(i=i.xfb_backup)==null?void 0:i.has_otc_eligible_devices)!=null?i:void 0,offlineDevicesCountInitialValue:n,vestaClientIDInitialValue:e,children:j.jsx(c("MWEBFlowSourceContextProvider.react"),{source:a,children:j.jsx(c("MWChatEncryptedBackupsRestoreUpsellDialogContextProvider.react"),{disableDismissalDialog:g,setIsDialogPersisted:function(a){l==null?void 0:l(a)},children:j.jsx(d("MWChatEncryptedBackupsVestaUserInfoContext.react").VestaUserInfoContext.Provider,{value:o,children:j.jsx(c("MWEncryptedBackupsOTCEligibleDevicesContextProvider.react"),{children:j.jsx(c("CometTransientDialogProvider.react"),{children:f})})})})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PAKEClientTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({PAKE_TEST:-1,ENCRYPTED_BACKUPS:0});f["default"]=a}),66);
__d("useMWAbandonRestoreConfirmationDialog",["fbt","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","gkx","react","useMWXConfirmationDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=(i||d("react")).useCallback;function a(a){var b=c("useMWXConfirmationDialog")(),e=c("gkx")("23219");return j(function(){b({body:e?h._("__JHASH__igJ7_fPkBWf__JHASH__"):h._("__JHASH__mJ4KzCvoneV__JHASH__"),confirm:h._("__JHASH__NclomsdgTqa__JHASH__"),title:h._("__JHASH__Lc-TiofSivN__JHASH__")},function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"DONT_RESTORE_CONFIRMATION_CLICK"),a==null?void 0:a()},function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"DONT_RESTORE_CANCEL_CLICK")})},[b,e,a])}g["default"]=a}),226);
__d("MWEBRestoreDialog.react",["InteractionTracing.xplat","MAWEncryptedBackupsRestoreStep.react","MAWPinCodeGating","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWChatEncryptedBackupsRingIndeterminateIcon.react","MWChatEncryptedBackupsVirtualDevicesContext.react","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsForgotPinStep","MWEncryptedBackupsForgotRCStep","MWEncryptedBackupsOtcRestoreSteps","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWXMultiStepDialog.react","PAKECleanupSessionReasonEnum","PAKEClientTypeEnum","QPLUserFlow","cr:5458","promiseDone","react","requireDeferred","useLabyrinthLogging","useMWAbandonRestoreConfirmationDialog","useMWEBFlowSourceContext","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));e=i;var k=e.useCallback,l=e.useContext,m=e.useEffect,n=e.useRef,o=c("requireDeferred")("CleanupPakeSession").__setRef("MWEBRestoreDialog.react"),p=c("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEBRestoreDialog.react");function a(a){var e=a.addDeferUpsellQplAnnotation,f=a.cancellable;f=f===void 0?!0:f;var g=a.isDismissDisabled,i=a.onClose,q=a.onDismissUpsell,r=n(!1),s=(h||(h=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var t=a.startFlow,u=c("useMWEBFlowSourceContext")();a=l(c("MWChatEncryptedBackupsVirtualDevicesContext.react"));var v=a.virtualDeviceInfo;a=k(function(){q==null?void 0:q(),d("MWChatEncryptedBackupsLogging").closeDialogCancelFlow({event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,onClose:function(){return i()}}),v.doesUserHaveOtcEligibleDevices===!0&&o.onReady(function(a){c("promiseDone")(a({cleanupReason:c("PAKECleanupSessionReasonEnum").FLOW_ABANDONED,clientType:c("PAKEClientTypeEnum").ENCRYPTED_BACKUPS,deviceId:d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),storage:s}))})},[q,v.doesUserHaveOtcEligibleDevices,i,s]);var w=c("useMWAbandonRestoreConfirmationDialog")(a),x=function(){e==null?void 0:e(),i()},y=b("cr:5458")==null?void 0:b("cr:5458")({onComplete:x}),z=v.vestaClientID!=null;m(function(){r.current||(r.current=!0,d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:s,onFetch:function(a){var b=a.ebsmWiped,e=a.firstUpsellTime,f=a.hasEbKeysLocally,g=a.hasEBSM,h=a.hasPDB,i=a.hasUserRestoredBefore;a=a.hasUserRestoredBeforeTemp;var j=u();t({additionalAnnotations:{eb_session_identifier:e,ebsm_wiped:b,has_eb_keys_locally:f,has_ebsm:g,has_pdb:h,has_user_restored_before:i,has_user_restored_before_temp:a,restore_upsell_first_impression_time:e},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:j});j===c("MWChatEncryptedBackupsQPLSource.enum").INBOX_INTERSTITIAL_SOFTBLOCK&&(c("InteractionTracing.xplat").getPendingInteractions().forEach(function(a){a.addAnnotationBoolean("eb_soft_block",!0)}),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"INBOX_SOFTBLOCK_RESTORE_SCREEN"));c("promiseDone")(p.load(),function(a){return a(f)})}}))},[u,t,s]);return j.jsx(c("MWXMultiStepDialog.react"),{onClose:g?function(){}:w,size:"small",withCloseButton:f,children:function(a){if(v.offlineDevicesCount===-1)return j.jsx(c("MWChatEncryptedBackupsRingIndeterminateIcon.react"),{});var b=y!=null?y.onPushAutoRestoreConsentPage(a):i;return j.jsx(c("MAWEncryptedBackupsRestoreStep.react"),{clientID:d("MAWPinCodeGating").isPinCodeEnabled()&&z?v.vestaClientID:null,offlineDevicesCount:v.offlineDevicesCount,onChooseOtc:v.doesUserHaveOtcEligibleDevices?function(){return d("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onOtcComplete:b,pushPage:a})}:null,onClose:w,onComplete:b,onForgotPin:function(){d("MWEncryptedBackupsForgotPinStep").pushForgotPinPage({offlineDeviceCount:v.offlineDevicesCount,onClose:i,onComplete:x,pushPage:a})},onForgotRC:function(){d("MWEncryptedBackupsForgotRCStep").pushForgotRCPage({onClose:i,onComplete:x,pushPage:a})},pushPage:a,shouldShowForgotButton:!0})}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWChatEncryptedBackupsAutoRestoreConsentStep",["MWChatEncryptedBackupsAutoRestoreConsentStepDeferred.react","MWChatEncryptedBackupsDisableDismissalDialogContext","MWChatEncryptedBackupsQPLEvents","react","useLabyrinthLogging","useMWEBFlowSourceContext"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext;function a(a){var b=a.onComplete,e=j(c("MWChatEncryptedBackupsDisableDismissalDialogContext")).disableDismissalDialog,f=c("useMWEBFlowSourceContext")();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var g=a.startFlow;a=function(a){return function(){e==null?void 0:e(),g({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,source:f()}),a(function(){return i.jsx(c("MWChatEncryptedBackupsAutoRestoreConsentStepDeferred.react"),{onComplete:b})},{withoutBackButton:!0,withoutCloseButton:!0})}};return{onPushAutoRestoreConsentPage:a}}g["default"]=a}),98);
__d("LSFetchOTCEligibleEBDevicesV2",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return c.forEach(c.db.table(261).fetch(),function(a){return a["delete"]()})},function(a){return d[0]="",c.forEach(c.filter(c.db.table(261).fetch([[[d[0]]]]),function(a){return a.deviceId===d[0]&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(261).add({deviceId:d[0],authorityLevel:c.i64.cast([0,20])})},function(a){return d[1]=new c.Map(),d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),"meb_fetch_otc_eligible_devices",c.i64.cast([0,50028]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}e.exports=a}),null);