;/*FB_PKG_DELIM*/

__d("MWEBQPOneTimeCode.react",["ix","CometImageFromIXValue.react","gkx","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("gkx")("23433");b=j.forwardRef(a);function a(a,b){var d=a.alt;a=a.xstyle;var e=k?h("421460"):h("421458");return j.jsx(c("CometImageFromIXValue.react"),{alt:d,ref:b,source:e,xstyle:a})}a.displayName=a.name+" [from "+f.id+"]";e=b;g["default"]=e}),98);
__d("LSFetchOTCEligibleEBDevicesV2StoredProcedure",["LSFetchOTCEligibleEBDevicesV2","cr:8709"],(function(a,b,c,d,e,f,g){function a(a){return c("LSFetchOTCEligibleEBDevicesV2")(a)}g["default"]=a}),98);
__d("useFetchOTCEligibleEBDevices",["FBLogger","LSAuthorityLevel","LSFactory","LSFetchOTCEligibleEBDevicesV2StoredProcedure","LSIntEnum","ReQL","ReQLSuspense","gkx","promiseDone","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useCallback,l=b.useEffect,m=b.useRef,n=b.useState,o=c("gkx")("24064");function a(){var a=(h||(h=c("useReStore")))(),b=m(!1),e=n(!1),g=e[0],j=e[1];e=n(!1);var p=e[0],q=e[1];e=n(!1);var r=e[0],s=e[1];e=n(!1);var t=e[0],u=e[1];e=n([]);var v=e[0],w=e[1],x=d("ReQLSuspense").useArray(function(){return g?d("ReQL").fromTableAscending(a.table("encrypted_backups_otc_devices")):d("ReQL").empty()},[g,a],f.id+":49"),y=k(function(){return a.runInTransaction(function(a){return c("LSFetchOTCEligibleEBDevicesV2StoredProcedure")(c("LSFactory")(a))},"readwrite")},[a]),z=k(function(){q(!0),s(!1),c("promiseDone")(y(),function(){j(!0)},function(){c("FBLogger")("labyrinth_web").mustfix("Failed to fetch OTC eligible devices")})},[y]);l(function(){if(b.current!==!0)b.current=!0,z();else if(g){var a=x.length>0&&(i||(i=d("LSIntEnum"))).toNumber(x[0].authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;if(!a){q(!1);j(!1);a=x[0];a=a.deviceId==="-1";if(a){s(!0);c("FBLogger")("labyrinth_web").mustfix("Encrypted Backups OTC: Failed to fetch otc eligible devices.");return}a=x.filter(function(a){return(i||(i=d("LSIntEnum"))).toNumber(a.authorityLevel)!==c("LSAuthorityLevel").OPTIMISTIC&&a.deviceId!==""});w(a);u(a.length>0||o)}}},[y,g,x,z]);return{doesUserHaveOtcEligibleDevices:t,failedToFetchOtcDevices:r,isFetchOtcDevicesInFlight:p,otcEligibleDevices:v,triggerFetchOtcEligibleDevices:z}}g["default"]=a}),98);
__d("usePakeInitiatorManager",["FBLogger","PakeCpaceWasm","Promise","asyncToGeneratorRuntime","promiseDone","react","requireDeferred","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=i||d("react");var j=e.useCallback,k=e.useEffect,l=e.useRef,m=c("requireDeferred")("establishPakeHandshakeAsInitiator").__setRef("usePakeInitiatorManager"),n=3e4;function a(a){var e=a.onGeneralFailure,f=a.onMaxAttemptsReached,g=a.onNoSessionExists,i=a.onSessionExpired,o=a.onSuccessfulSecretDecryption,p=a.onWrongOtc,q=a.timeout,r=q===void 0?n:q,s=a.clientType,t=c("useAsyncReStore")(),u=l(null),v=l(function(){}),w=l(function(){}),x=l(null),y=l(!1);k(function(){y.current===!1&&(y.current=!0,c("promiseDone")(d("PakeCpaceWasm").PakeCPaceWasm().then(function(a){x.current=a}),void 0,function(){c("FBLogger")("labyrinth_web").mustfix("PAKE: Error loading WASM module")}));return function(){var a;w.current();(a=u.current)==null?void 0:a["delete"]();v.current()}},[]);return{establishPakeHandshakeAsInitiator:j(function(a){return(h||(h=b("Promise"))).all([t,m.load()]).then(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b[0];b=b[1];b=(yield b({clientType:s,onGeneralFailure:e,onMaxAttemptsReached:f,onNoSessionExists:g,onSessionExpired:i,onSuccessfulSecretDecryption:o,onWrongOtc:p,otc:a,pakeCpaceModule:x.current,storage:c,timeout:r}));c=b.pakeClient;var d=b.stopTimeout;b=b.unsubFromMessagesTable;u.current=c;v.current=d;w.current=b});return function(a){return c.apply(this,arguments)}}())},[s,t,e,f,g,i,o,p,r])}}g["default"]=a}),98);
__d("MWEncryptedBackupsInsertOTCStep.react",["fbt","EBSMGating","FBLogger","FocusRegion.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSetIsDialogPersistedContext","MWEBQPOneTimeCode.react","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsOTCEligibleDevicesContext.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXLink.react","MWXMultiStepDialogHeader.react","MWXSpinner.react","MWXText.react","PAKEClientTypeEnum","QPLUserFlow","focusScopeQueries","gkx","promiseDone","react","requireDeferred","useFetchOTCEligibleEBDevices","useMWChatEncryptedBackupsNumericCode","useMWEBFlowSourceContext","usePakeInitiatorManager","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useCallback,m=b.useContext,n=b.useEffect,o=b.useRef,p=b.useState,q=c("requireDeferred")("MWEBUseLocalStorage").__setRef("MWEncryptedBackupsInsertOTCStep.react"),r=c("requireDeferred")("MWEncrypedBackupsSendOTCNotifications").__setRef("MWEncryptedBackupsInsertOTCStep.react"),s=c("requireDeferred")("MWEncryptedBackupsFetchBackupIds").__setRef("MWEncryptedBackupsInsertOTCStep.react"),t=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("MWEncryptedBackupsInsertOTCStep.react"),u=c("requireDeferred")("deserializeSecretsAndAddDevice").__setRef("MWEncryptedBackupsInsertOTCStep.react"),v="chat-encrypted-backups-dialog-layout-second-step",w=6,x=c("gkx")("23219"),y=c("gkx")("20861"),z=function(){return h._("__JHASH__lBlURV9iIv0__JHASH__")},A=function(){return h._("__JHASH__rIH_-tfv2x2__JHASH__")},B=function(){return h._("__JHASH__WypD50Gdi03__JHASH__")},C=function(){return h._("__JHASH__7uRJ4wtXcoz__JHASH__")},D=function(){return h._("__JHASH__XUu1h3R4qPj__JHASH__")},E=function(){return h._("__JHASH__ndaWq552FSK__JHASH__")},F=function(){return h._("__JHASH__WoNRZZnIdhP__JHASH__")};function a(a){var b=a.onComplete,e=a.onViewAllDevices;a=p(!1);var f=a[0],g=a[1],j=o(!1),G=o(!1),H=o(function(){}),I=o(function(){});a=p(null);var J=a[0],K=a[1],L=(i||(i=c("useReStore")))();a=c("useFetchOTCEligibleEBDevices")();var M=a.failedToFetchOtcDevices,N=a.isFetchOtcDevicesInFlight,O=a.otcEligibleDevices,P=a.triggerFetchOtcEligibleDevices;a=m(d("MWEncryptedBackupsOTCEligibleDevicesContext.react").MWEncryptedBackupsOTCEligibleDevicesContext);var Q=a.setFailedToFetchOtcDevices,R=a.setIsFetchOtcDevicesInFlight,S=a.setOtcEligibleDevices,T=c("useMWEBFlowSourceContext")(),U=m(c("MWChatEncryptedBackupsSetIsDialogPersistedContext")).setIsDialogPersisted;n(function(){return function(){H.current(),I.current()}},[]);n(function(){j.current===!1&&(j.current=!0,r.onReady(function(a){a=a.sendOTCNotifications;c("promiseDone")(a({db:L,onFailure:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_SEND_NOTIFICATION_FAILURE"),K(E())},otcEligibleDevices:[]}),function(a){H.current=a},function(){c("FBLogger")("labyrinth_web").mustfix("OTC: Send otc notifications sproc failed."),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_SEND_NOTIFICATION_FAILURE"),K(E())})})),R(N),S(O),Q(M)},[L,M,N,O,Q,R,S]);a=c("usePakeInitiatorManager")({clientType:c("PAKEClientTypeEnum").ENCRYPTED_BACKUPS,onGeneralFailure:l(function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_API_FAILURE"),K(D()),G.current=!0,g(!1),U==null?void 0:U(!1)},[U]),onMaxAttemptsReached:l(function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_MAX_ATTEMPTS_REACHED"),K(B()),G.current=!0,g(!1)},[]),onNoSessionExists:l(function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_NO_SESSION"),K(A()),G.current=!0,g(!1)},[]),onSessionExpired:l(function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SESSION_EXPIRED"),K(C()),G.current=!0,g(!1)},[]),onSuccessfulSecretDecryption:l(function(a){var e=a.decryptedSecret,f=a.initiatorId;U==null?void 0:U(!0);c("promiseDone")(u.load(),function(a){c("promiseDone")(a({db:L,initiatorId:f,onAddDeviceFailure:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_ADD_DEVICE_FAILURE"),K(D()),G.current=!0,g(!1),U==null?void 0:U(!1)},onAddDeviceFinish:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_ADD_DEVICE_FINISHED"),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),t.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:L,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}))}),q.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;c("gkx")("2249")&&b(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),b(),g(!1),s.onReady(function(a){a=a.encryptedBackupsFetchBackupIds;a(L)["catch"](function(a){return c("FBLogger")("labyrinth_web").mustfix("OTC Restore: Error when fetching backup ids, %s",a)})})},secrets:e}),function(a){I.current=a})})},[L,b,U]),onWrongOtc:l(function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_INCORRECT_CODE"),K(z()),G.current=!0,g(!1)},[])});var V=a.establishPakeHandshakeAsInitiator;a=d("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode({focusRegionId:v,inputSize:w,onChange:function(){K()},onComplete:function(a){var b=T();c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"one_time_code",source:b}});g(!0);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SUBMIT");c("promiseDone")(V(a))}});var W=a[0];a=a[1];var X=a.clearNumericInput,Y=a.focusOnInput;a=a.isLoading;n(function(){G.current&&(X(),G.current=!1)},[X]);var Z=c("useVisibilityObserver")({onVisible:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_SCREEN"),Y()}}),$=h._("__JHASH__mdY4-jjsr2I__JHASH__");return k.jsxs(k.Fragment,{children:[k.jsx(c("MWXMultiStepDialogHeader.react"),{withCloseButton:!1,withoutBackButton:!0,withoutHeaderBottomBorder:!0}),k.jsx(c("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,ref:Z,children:k.jsx("div",{className:"x2lwn1j",children:k.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:16,spacing:8,children:[k.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:16,children:k.jsx("div",{className:"xg87l8a",children:k.jsx(c("MWEBQPOneTimeCode.react"),{})})}),k.jsx(c("MWXColumnItem.react"),{align:"center",paddingVertical:16,children:k.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:$})}),k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",{className:"x1l90r2v x2b8uid",children:k.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._("__JHASH__lzSAd4UfKCU__JHASH__")})})}),k.jsxs(c("MWXColumnItem.react"),{align:"center",children:[k.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:J,children:k.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,id:v,children:k.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({},W,{disabled:a||f,testid:void 0}))})}),y&&J===D()?k.jsx("div",{className:"xwib8y2",children:k.jsx(c("MWXText.react"),{align:"center",color:"negative",type:"body4",children:h._("__JHASH__47yJJ8U23lB__JHASH__")})}):null,f?k.jsxs("div",{className:"x6s0dn4 x78zum5 xl56j7k x135pmgq xwib8y2",children:[k.jsx("div",{className:"x1sxyh0",children:k.jsx(c("MWXSpinner.react"),{color:x?"disabled":"blue",size:12})}),k.jsx(c("MWXText.react"),{color:"secondary",testid:void 0,type:"meta3",children:h._("__JHASH__zNLcSfOKcLf__JHASH__")})]}):null]}),k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",{className:"x1y1aw1k",children:k.jsx(c("MWXLink.react"),{color:x?"primary":"highlight",disabled:f||a,display:"block",onClick:function(){X(),K(),e({onFetchOtcEligibleDevicesError:function(){K(F()),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FETCH_OTC_ELIGIBLE_DEVICES_FAILURE"),P()},onResendCodeFailure:function(){K(E()),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESEND_NOTIFICATION_FAILURE")}}),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_VIEW_ALL_DEVICES_CLICK")},rel:"noreferrer",children:k.jsx(c("MWXText.react"),{color:f?"disabled":"highlight",type:"button2",children:h._("__JHASH__UdIx77e_03V__JHASH__")})})})})]})})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);